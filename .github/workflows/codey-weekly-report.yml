# .github/workflows/codey-weekly-report.yml
name: ğŸ“Š Weekly Codey Report

on:
  schedule:
    # Jeden Sonntag um 18:00 UTC
    - cron: '0 18 * * 0'
  workflow_dispatch:

jobs:
  weekly-report:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write

    steps:
    - name: ğŸš€ Checkout
      uses: actions/checkout@v4

    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ğŸ“Š Generate Weekly Report
      run: |
        python scripts/weekly_report.py

    - name: ğŸ“ Create Issue with Report
      uses: actions/github-script@v7
      with:
        script: |
          const fs = require('fs');
          const reportExists = fs.existsSync('codey-weekly-report.svg');
          
          if (reportExists) {
            const title = `ğŸ“Š Codey Weekly Report - ${new Date().toLocaleDateString()}`;
            const body = `## ğŸ¾ Dein wÃ¶chentlicher Codey Report!

![Weekly Report](https://github.com/${{ github.repository }}/blob/main/codey-weekly-report.svg)

### ğŸ“ˆ Diese Woche:
- Codey hat fleiÃŸig deine GitHub-AktivitÃ¤t verfolgt
- Neue Achievements freigeschaltet? Schau in deinen Commits nach! 
- Vergiss nicht, Codey regelmÃ¤ÃŸig zu fÃ¼ttern ğŸ–

### ğŸ’¡ Tipps fÃ¼r nÃ¤chste Woche:
- Halte deine Commit-Serie am Laufen ğŸ”¥
- Merge ein paar Pull Requests fÃ¼r extra GlÃ¼ck ğŸ˜Š
- SchlieÃŸe Issues fÃ¼r Codey's Wohlbefinden âœ…

*Automatisch generiert von deinem Codey Bot ğŸ¤–*`;

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['codey', 'weekly-report', 'automated']
            });
          }

    - name: ğŸ’¾ Commit Weekly Report
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Codey Reporter ğŸ“Š"
        
        if [[ -f "codey-weekly-report.svg" ]]; then
          git add codey-weekly-report.svg
          git commit -m "ğŸ“Š Weekly Codey Report - $(date +'%Y-%m-%d')" || echo "No changes"
          git push || echo "Nothing to push"
        fi

---

# .github/workflows/codey-language-detection.yml
name: ğŸ” Codey Language Evolution

on:
  push:
    branches: [ main ]
  schedule:
    # TÃ¤glich um 12:00 prÃ¼fen
    - cron: '0 12 * * *'

jobs:
  detect-languages:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: ğŸš€ Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # VollstÃ¤ndige Historie fÃ¼r Analyse

    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ğŸ“¦ Install GitHub CLI
      run: |
        gh --version || (curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
        echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
        sudo apt update && sudo apt install gh)

    - name: ğŸ” Analyze Repository Languages
      run: |
        python scripts/language_analyzer.py
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: ğŸ¨ Update Evolution if Needed
      run: |
        python scripts/update_evolution.py

    - name: ğŸ’¾ Commit Evolution Changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Codey Evolution ğŸ§¬"
        
        if [[ `git status --porcelain` ]]; then
          git add codey-data.json codey.svg
          git commit -m "ğŸ§¬ Codey evolution update based on language usage"
          git push
        fi

---

# .github/workflows/codey-interaction.yml
name: ğŸ® Codey Manual Interaction

on:
  issues:
    types: [opened]
  issue_comment:
    types: [created]

jobs:
  handle-interaction:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.title, 'codey') || contains(github.event.comment.body, '/codey')
    permissions:
      contents: write
      issues: write

    steps:
    - name: ğŸš€ Checkout
      uses: actions/checkout@v4

    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ğŸ® Parse Command
      id: parse
      uses: actions/github-script@v7
      with:
        script: |
          const body = context.payload.comment?.body || context.payload.issue?.body || '';
          const commands = {
            '/codey status': 'status',
            '/codey feed': 'feed',
            '/codey pet': 'pet',
            '/codey heal': 'heal',
            '/codey stats': 'stats'
          };
          
          for (const [cmd, action] of Object.entries(commands)) {
            if (body.includes(cmd)) {
              core.setOutput('command', action);
              return;
            }
          }
          core.setOutput('command', 'unknown');

    - name: ğŸ– Execute Codey Command
      if: steps.parse.outputs.command != 'unknown'
      run: |
        python scripts/manual_interaction.py "${{ steps.parse.outputs.command }}"

    - name: ğŸ’¬ Respond to User
      uses: actions/github-script@v7
      with:
        script: |
          const command = '${{ steps.parse.outputs.command }}';
          const responses = {
            'status': 'ğŸ¾ Hier ist Codey\'s aktueller Status! Schau dir das SVG in deinem Profil an.',
            'feed': 'ğŸ– Codey wurde gefÃ¼ttert! Seine Hunger-Werte steigen.',
            'pet': 'ğŸ˜Š Du hast Codey gestreichelt! Er ist jetzt glÃ¼cklicher.',
            'heal': 'ğŸ’š Codey wurde geheilt und fÃ¼hlt sich besser!',
            'stats': 'ğŸ“Š Hier sind Codey\'s detaillierte Statistiken!',
            'unknown': 'â“ Unbekannter Befehl. VerfÃ¼gbare Befehle: `/codey status`, `/codey feed`, `/codey pet`, `/codey heal`, `/codey stats`'
          };
          
          const response = responses[command] || responses['unknown'];
          
          const issueNumber = context.payload.issue?.number || context.payload.pull_request?.number;
          
          await github.rest.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: issueNumber,
            body: `${response}

![Codey Status](https://github.com/${{ github.repository }}/blob/main/codey.svg)

*Automatische Antwort vom Codey Bot ğŸ¤–*`
          });

---

# .github/workflows/codey-backup.yml
name: ğŸ’¾ Codey Data Backup

on:
  schedule:
    # TÃ¤glich um 2:00 UTC backup
    - cron: '0 2 * * *'
  workflow_dispatch:

jobs:
  backup-data:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: ğŸš€ Checkout
      uses: actions/checkout@v4

    - name: ğŸ“… Create Backup
      run: |
        mkdir -p backups
        DATE=$(date +%Y-%m-%d)
        
        # Backup aller wichtigen Dateien
        if [[ -f "codey-data.json" ]]; then
          cp codey-data.json "backups/codey-data-$DATE.json"
        fi
        
        if [[ -f "codey.svg" ]]; then
          cp codey.svg "backups/codey-$DATE.svg"
        fi
        
        # Cleanup alte Backups (behalte nur 30 Tage)
        find backups/ -name "codey-data-*.json" -mtime +30 -delete
        find backups/ -name "codey-*.svg" -mtime +30 -delete

    - name: ğŸ“Š Generate Backup Report
      run: |
        echo "# ğŸ’¾ Codey Backup Report - $(date)" > backup-report.md
        echo "" >> backup-report.md
        echo "## Backup Status:" >> backup-report.md
        echo "- Date: $(date)" >> backup-report.md
        echo "- Files backed up: $(ls backups/ | wc -l)" >> backup-report.md
        echo "- Last backup size: $(du -h backups/ | tail -1)" >> backup-report.md
        echo "" >> backup-report.md
        echo "## Recent Backups:" >> backup-report.md
        ls -la backups/ | tail -10 >> backup-report.md

    - name: ğŸ’¾ Commit Backup
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Codey Backup Bot ğŸ’¾"
        
        if [[ `git status --porcelain` ]]; then
          git add backups/ backup-report.md
          git commit -m "ğŸ’¾ Daily backup - $(date +'%Y-%m-%d %H:%M')"
          git push
        else
          echo "No new backups to commit"
        fi

---

# .github/workflows/codey-analytics.yml
name: ğŸ“ˆ Codey Analytics Dashboard

on:
  schedule:
    # WÃ¶chentlich am Montag um 9:00
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  generate-analytics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write

    steps:
    - name: ğŸš€ Checkout
      uses: actions/checkout@v4

    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ğŸ“¦ Install Dependencies
      run: |
        pip install matplotlib seaborn pandas plotly

    - name: ğŸ“Š Generate Analytics
      run: |
        python scripts/generate_analytics.py

    - name: ğŸ“± Create GitHub Pages
      run: |
        mkdir -p docs
        python scripts/create_dashboard.py

    - name: ğŸš€ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs
        commit_message: "ğŸ“Š Update Codey Analytics Dashboard"

---

# .github/workflows/codey-social.yml  
name: ğŸ¦ Codey Social Media

on:
  schedule:
    # Bei besonderen Achievements
    - cron: '0 15 * * *'  # 15:00 tÃ¤glich prÃ¼fen
  workflow_dispatch:

jobs:
  social-update:
    runs-on: ubuntu-latest
    if: github.repository_owner == github.actor
    
    steps:
    - name: ğŸš€ Checkout
      uses: actions/checkout@v4

    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ğŸ‰ Check for Milestone Achievements
      id: check-milestone
      run: |
        python scripts/check_social_worthy.py
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: ğŸ¦ Tweet Achievement (optional)
      if: steps.check-milestone.outputs.should_tweet == 'true' && secrets.TWITTER_API_KEY
      run: |
        python scripts/tweet_achievement.py
      env:
        TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
        TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
        TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
        TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}

    - name: ğŸ“¸ Update Profile README with Special Badge
      if: steps.check-milestone.outputs.special_badge == 'true'
      run: |
        python scripts/add_special_badge.py
        
        git config --local user.email "action@github.com"
        git config --local user.name "Codey Social ğŸ¦"
        
        if [[ `git status --porcelain` ]]; then
          git add README.md
          git commit -m "ğŸ† Special achievement badge added!"
          git push
        fi
